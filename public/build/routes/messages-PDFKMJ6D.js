import{a as S}from"/build/_shared/chunk-H3RZE2CH.js";import{a as C,e as a,f as w}from"/build/_shared/chunk-OIX5OCDU.js";import{a as l,e as h,f as x}from"/build/_shared/chunk-B7FGBX3E.js";import{g as f,k as p}from"/build/_shared/chunk-25BYIYGU.js";import{d as N}from"/build/_shared/chunk-WQPAJ64N.js";import{a as M,b as v}from"/build/_shared/chunk-2Z2BTQU4.js";import{d as r}from"/build/_shared/chunk-ZT4QWOFN.js";var y=r(C(),1);var c=r(M(),1);var k=r(S(),1);var e=r(v(),1);function b(){let{conversations:o,users:m,messages:I}=p(),{data:n}=N(),[t,d]=(0,c.useState)(null),[A,i]=(0,c.useState)(!1);if(!n?.user)return(0,e.jsx)("div",{className:"p-4 text-center",children:"Please sign in to view messages"});let u=t?o.find(s=>s.id===t)??m.find(s=>s.id===t):null,g=t?I.filter(s=>s.senderId===n.user.id&&s.receiverId===t||s.receiverId===n.user.id&&s.senderId===t):[];return(0,e.jsx)("div",{className:"min-h-screen pb-20",children:u?(0,e.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,e.jsxs)("div",{className:"p-4 border-b flex items-center gap-2 bg-white sticky top-0 z-10",children:[(0,e.jsx)(a,{variant:"ghost",size:"icon",onClick:()=>d(null),className:"p-0 w-8 h-8",children:(0,e.jsx)(l,{})}),(0,e.jsx)("h2",{className:"font-bold text-lg",children:u.name})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-3",children:g.length===0?(0,e.jsx)("p",{className:"text-center text-gray-500 py-8",children:"No messages yet. Start the conversation!"}):g.map(s=>(0,e.jsxs)("div",{className:`max-w-[80%] p-3 rounded-lg ${s.senderId===n.user.id?"bg-blue-500 text-white self-end rounded-br-none":"bg-gray-200 self-start rounded-bl-none"}`,children:[(0,e.jsx)("p",{children:s.message}),(0,e.jsx)("p",{className:"text-xs opacity-70 mt-1",children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},s.id))}),(0,e.jsxs)(f,{method:"post",className:"p-4 border-t bg-white sticky bottom-16 z-10",children:[(0,e.jsx)("input",{type:"hidden",name:"receiverId",value:t??""}),(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(w,{name:"message",placeholder:"Type a message...",className:"flex-1",required:!0,autoComplete:"off"}),(0,e.jsx)(a,{type:"submit",children:(0,e.jsx)(x,{size:18})})]})]})]}):A?(0,e.jsxs)("div",{className:"p-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,e.jsx)(a,{variant:"ghost",size:"icon",onClick:()=>i(!1),className:"p-1",children:(0,e.jsx)(l,{})}),(0,e.jsx)("h2",{className:"font-bold text-lg",children:"New Message"})]}),(0,e.jsx)("div",{className:"space-y-1",children:m.map(s=>(0,e.jsxs)(a,{variant:"ghost",className:"w-full justify-start p-4 h-auto",onClick:()=>{d(s.id),i(!1)},children:[(0,e.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-lg font-bold mr-3",children:s.image?(0,e.jsx)("img",{src:s.image,alt:s.name||"",className:"w-full h-full object-cover rounded-full"}):(s.name||"U").charAt(0).toUpperCase()}),(0,e.jsx)("span",{children:s.name})]},s.id))})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"p-4 border-b bg-white sticky top-0 z-10 flex justify-between items-center",children:[(0,e.jsx)("h1",{className:"text-lg font-bold",children:"Messages"}),(0,e.jsxs)(a,{onClick:()=>i(!0),children:[(0,e.jsx)(h,{size:16,className:"mr-1"}),"New"]})]}),(0,e.jsx)("div",{className:"divide-y",children:o.length===0?(0,e.jsxs)("div",{className:"py-12 text-center text-gray-500",children:[(0,e.jsx)("p",{className:"mb-4",children:"No conversations yet"}),(0,e.jsx)(a,{onClick:()=>i(!0),children:"Start a new conversation"})]}):o.map(s=>(0,e.jsxs)("button",{className:"w-full p-4 flex items-start gap-3 text-left",onClick:()=>d(s.id),children:[(0,e.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-lg font-bold",children:(s.name||"U").charAt(0).toUpperCase()}),(0,e.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,e.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,e.jsx)("h3",{className:"font-bold truncate",children:s.name}),(0,e.jsx)("span",{className:"text-xs text-gray-500",children:new Date(s.lastMessageTime).toLocaleDateString()})]}),(0,e.jsx)("p",{className:"text-sm text-gray-600 truncate",children:s.lastMessage})]}),s.unreadCount>0&&(0,e.jsx)("div",{className:"w-5 h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center",children:s.unreadCount})]},s.id))})]})})}export{b as default};
